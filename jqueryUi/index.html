<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.5/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.5/themes/default/datagrid.css">
    <link rel="stylesheet" type="text/css" href="jquery-easyui-1.5/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="commonPage.css">
    <script src="jquery-easyui-1.5/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="jquery-easyui-1.5/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="easyui-lang-zh_CN.js" type="text/javascript" charset="utf-8"></script>
    <script src="commonPage.js" type="text/javascript" charset="utf-8"></script>
    <script src="kindeditor-all-min.js" type="text/javascript" charset="utf-8"></script>
    <script src="shareMng.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>
    <div id="serchFormDiv" data-options="region:'north' ,title:'查询条件'">
        <form id="serchForm" method="post" novalidate>
            <label>借书人姓名：</label>
            <input name="jsname" class="easyui-validatebox" style="width: 210px" />
            <label>状态：</label>
            <select name="state" class="easyui-combobox" data-options="valueField:'key',textField:'value',data:share_book_status" editable=“false” style="width: 200px"></select>
            <!-- <select name="state" class="easyui-combobox" required="true" editable=“false” style="width: 200px">
				<option value="3">已取消</option>
				<option value="0">可借阅</option>
				<option value="1">申请中</option>
				<option value="2">借阅中</option>
				
				<option value="4">归还中</option>
				<option value="5">已完成</option>
				<option value="6">已拒绝</option>
				
				
			</select> -->
            <input style="display:none;">
            <a id="searchButtion" href="#">搜索</a>
            <a id="resetButtion" href="javascript:void(0)">重置</a>
        </form>
    </div>
    <div id="dataDiv" data-options="region:'center'">
        <table id="dg" title="Client Side Pagination" style="width:700px;height:300px" data-options="
				rownumbers:true,
				singleSelect:true,
				autoRowHeight:false,
				pagination:true,
				pageSize:10">
            <thead>
                <tr>
                    <th field="jsname" width="50">借书人用户名</th>
                    <th field="gxname" width="50">有书人用户名</th>
                    <th field="bookname" width="120">书名</th>
                    <!-- <th field="bookauthor" width="50">书的作者</th> -->
                    <th field="jsaddress" width="50">借书人地址</th>
                    <th field="gxaddress" width="50">取书地址</th>
                    <th field="startdate" width="60" formatter="dateTimeFormat">借阅开始时间</th>
                    <th field="jsphone" width="50">借书人联系方式</th>
                    <th field="gxphone" width="50">有书人联系方式</th>
                    <!-- <th field="bookimage" width="50">图片</th> -->
                    <th field="qsfs" width="50" formatter="statusFormat">取书方式</th>
                    <th field="state" width="50" formatter="common.createFormatterFn('share_book_status')">状态</th>
                </tr>
            </thead>
        </table>
    </div>
    <div id="toolbar">
        <a id="addButton" href="javascript:void(0)">增加</a>
        <a id="editButton" href="javascript:void(0)">编辑</a>
        <a id="delButton" href="javascript:void(0)">删除</a>
    </div>
    <div id="editDiv" style="width:450px;height:380px;">
        <form id="editForm" method="post" novalidate>
            <div class="editInputDiv">
                <label>书名:</label>
                <input id="bookname" name="bookname" class="easyui-validatebox" required="true" validType="length[0,200]" style="width: 300px" />
            </div>
            <div class="editInputDiv">
                <label>借书人用户名:</label>
                <input id="jsname" name="jsname" class="easyui-validatebox" required="true" validType="length[0,200]" style="width: 300px" />
            </div>
        </form>
        <div id="editButtonsDiv">
            <a id="editSaveButton" href="javascript:void(0)">提交</a>
            <a id="editCancelButton" href="javascript:void(0)">取消</a>
        </div>
    </div>
    <script>
    (function($) {
        function pagerFilter(data) {
            if ($.isArray(data)) { // is array
                data = {
                    total: data.length,
                    rows: data
                }
            }
            var target = this;
            var dg = $(target);
            var state = dg.data('datagrid');
            var opts = dg.datagrid('options');
            if (!state.allRows) {
                state.allRows = (data.rows);
            }
            if (!opts.remoteSort && opts.sortName) {
                var names = opts.sortName.split(',');
                var orders = opts.sortOrder.split(',');
                state.allRows.sort(function(r1, r2) {
                    var r = 0;
                    for (var i = 0; i < names.length; i++) {
                        var sn = names[i];
                        var so = orders[i];
                        var col = $(target).datagrid('getColumnOption', sn);
                        var sortFunc = col.sorter || function(a, b) {
                            return a == b ? 0 : (a > b ? 1 : -1);
                        };
                        r = sortFunc(r1[sn], r2[sn]) * (so == 'asc' ? 1 : -1);
                        if (r != 0) {
                            return r;
                        }
                    }
                    return r;
                });
            }
            var start = (opts.pageNumber - 1) * parseInt(opts.pageSize);
            var end = start + parseInt(opts.pageSize);
            data.rows = state.allRows.slice(start, end);
            return data;
        }

        var loadDataMethod = $.fn.datagrid.methods.loadData;
        var deleteRowMethod = $.fn.datagrid.methods.deleteRow;
        $.extend($.fn.datagrid.methods, {
            clientPaging: function(jq) {
                return jq.each(function() {
                    var dg = $(this);
                    var state = dg.data('datagrid');
                    var opts = state.options;
                    opts.loadFilter = pagerFilter;
                    var onBeforeLoad = opts.onBeforeLoad;
                    opts.onBeforeLoad = function(param) {
                        state.allRows = null;
                        return onBeforeLoad.call(this, param);
                    }
                    var pager = dg.datagrid('getPager');
                    pager.pagination({
                        onSelectPage: function(pageNum, pageSize) {
                            opts.pageNumber = pageNum;
                            opts.pageSize = pageSize;
                            pager.pagination('refresh', {
                                pageNumber: pageNum,
                                pageSize: pageSize
                            });
                            dg.datagrid('loadData', state.allRows);
                        }
                    });
                    $(this).datagrid('loadData', state.data);
                    if (opts.url) {
                        $(this).datagrid('reload');
                    }
                });
            },
            loadData: function(jq, data) {
                jq.each(function() {
                    $(this).data('datagrid').allRows = null;
                });
                return loadDataMethod.call($.fn.datagrid.methods, jq, data);
            },
            deleteRow: function(jq, index) {
                return jq.each(function() {
                    var row = $(this).datagrid('getRows')[index];
                    deleteRowMethod.call($.fn.datagrid.methods, $(this), index);
                    var state = $(this).data('datagrid');
                    if (state.options.loadFilter == pagerFilter) {
                        for (var i = 0; i < state.allRows.length; i++) {
                            if (state.allRows[i] == row) {
                                state.allRows.splice(i, 1);
                                break;
                            }
                        }
                        $(this).datagrid('loadData', state.allRows);
                    }
                });
            },
            getAllRows: function(jq) {
                return jq.data('datagrid').allRows;
            }
        })
    })(jQuery);

    function getData() {
        var rows = [];
        for (var i = 1; i <= 800; i++) {
            var amount = Math.floor(Math.random() * 1000);
            var price = Math.floor(Math.random() * 1000);
            rows.push({
                inv: 'Inv No ' + i,
                date: $.fn.datebox.defaults.formatter(new Date()),
                name: 'Name ' + i,
                amount: amount,
                price: price,
                cost: amount * price,
                note: 'Note ' + i
            });
        }
        return rows;
    }

    $(function() {
        $('#dataDiv').datagrid({
            data: getData()
        }).datagrid('clientPaging');
    });
    </script>
</body>

</html>
